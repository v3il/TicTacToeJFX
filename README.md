# TicTcToeJFX

Проста гра "Крестики-нулики" на двох гравців, написана на Java FX


# L10n

Скрипты для локализации фронтенда новой ПУ из перловых сайнов

# Особенности

Скрипт понимает только конструкции вида ```uCoz.sign.get(string|usigned_integer, string)```, например:

```javascript
uCoz.sign.get('sign-id', 'Значение по умолчанию')
uCoz.sign.get(100500, 'Значение по умолчанию')
```

Следующие подходы НЕ работают:

```javascript
uCoz.sign.get(someVariable, 'Значение по умолчанию')
uCoz.sign.get('sign-id', someVariable)
var sign = uCoz.sign; sign.get('sign-id', 'Значение по умолчанию')
```

Т.е., при написании JS-кода с использованием надписей, достаточно писать что-то вроде:
```javascript
uCoz.sign.get('translate', 'Ололо, да это же сайн!!!')
```

Скрипт затем одуплит, как их завести/заменить и т.п.

# Начало работы

Эта ридмишка подразумевает, что мы уже сидим в директории ```L10n``` (```~/uCoz/www/src/panel/L10n```).

Если еще не устанавливались модули для L10n - установить:
```bash
npm install
```

# Алгоритм работы с L10n

## 1. Заводим сайны

Для начала, необходимо выдрать сайны из ```*.js``` файлов, которых еще нет в перловой базе (```*.l``` файлы) - если что, скрипт подскажет, как его нужно запускать:

```bash
./L10n new
```

Выхлоп (естественно, если скрипт не завалился с ошибкой) нужно скопировать в ```$HOME/uCoz/d/lng/ru/s.l``` рядом со своей группой сайнов (группа сайнов у нас зависит от дева, например, для dev013 это ```$sign{13XXXX}```).

ОБЯЗАТЕЛЬНО!!! делаем проверку перлового синтаксиса, дабы не поломать бек (мало ли, вдруг сайны генерятся битые какие-то):
```bash
perl -c $HOME/uCoz/d/lng/ru/s.l
```

Эта команда должна вернуть что-то вроде:
```
/home/devXXX/uCoz/d/lng/ru/s.l syntax OK
```

После добавления сгенерированного кода в ```*.l``` файлы, команда ```./L10n new``` будет возвращать пустую строку (новых-незаведенных сайнов нет, логично).

## 2. Пробрасываем сайны на фронт

Далее, необходимо сказать бекенду, какие же сайны нам стоит выплевывать на фронт (выплевывать нужно только те, которые используются в uCoz.sign.get, ибо если выдать все юкозовские сайны - браузер ляжет).

Для этого запускаем команду, которая выплюнет числовые ID-шки используемых сайнов:

```bash
./L10n used
```

Выхлоп копируем в ```$HOME/uCoz/cgi/lib/uCoz/Const/FrontendSigns.pm``` в переменную ```@id_list``` КАК ЕСТЬ (его редактировать не нужно):

```perl
# список ID сайнов, которые используются на фронте (uCoz.sign.get(...)):
my @id_list = qw(
100500
100501
100502
...
); # конец my @id_list
```

Тоже проверяем, не побили ли файл:

```bash
perl -c $HOME/uCoz/cgi/lib/uCoz/Const/FrontendSigns.pm
```

## 3. Применяем сайны в JS

И последним шагом заменяем в JS-е сайны (из уже обновленных ```*.l``` файлов) командой:

```bash
./L10n replace
```

Лучше после replace проверить git diff (что там скрипт наменял, вдруг побил что-то жестко).

Также на дев-серваке щас установлена последняя нода (node --version, должна быть 5-ая версия), поэтому чисто синтаксис можно проверить с помощью ```node -c path/to/file.js``` (если не матерится - синтаксис норм).

Но лучше все-таки глазами смотреть именно git diff.

И, в конце концов, билдим фронт и любуемся результатом:
```bash
cd $HOME/uCoz/www/src/panel # в директории L10n grunt не запустится
grunt
apachectlru_devXXX restart # чтобы применились изменения в перловых файлах
```

